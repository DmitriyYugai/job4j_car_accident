# Проект - Автонарушители
[![Build Status](https://travis-ci.org/DmitriyYugai/job4j_car_accident.svg?branch=master)](https://travis-ci.org/DmitriyYugai/job4j_car_accident)
# Содержание
* [Использованные технологии](#Использованные-технологии)
* [О проекте](#О-проекте)
* [Сборка](#Сборка)
* [Использование](#Использование)
* [Контакты](#Контакты)
## Использованные технологии
* Spring MVC
* Spring core (DI, IoC)
* Spring JDBC
* Spring Hibernate
* Spring Data JPA
* Spring Security
* Apache Commons DBCP (Database Connection Pooling)
* SLF4J и Log4j
* PostgreSQL
* Collections Framework
* JS, JQuery
* HTML, CSS, Bootstrap
* JSP
* JSTL
* Travis CI
## О проекте
* Данное веб-приложение представляет собой систему учёта автонарушений:<br><br>
![Главная страница](img/usage/index.PNG)<br><br>
* При добавлении нового инцидента нужно указать название, описание, адрес, выбрать тип инцидента 
(возможно выбрать только 1 тип) и статьи (возможно выбрать несколько):<br><br>
![Добавление инцидента 1](img/about/add.PNG)<br><br>
![Добавление инцидента 2](img/about/add1.PNG)<br><br>
* Возможно также редактировать уже существующие инциденты:<br><br>
![Редактирование инцидента](img/about/edit.PNG)<br><br>
* Список доступных статей и типов можно поменять (см. раздел "[Сборка](#Сборка)")<br><br>
* Неавторизованные пользователи с приложением работать не могут<br><br>
* Регистрация основана на контроллере RegControl, который инициирует сохранение новых пользователей в БД. 
Форма регистрации:<br><br>
![Регистрация пользователя](img/about/reg.PNG)<br><br>
* Авторизация построена на Spring Security. Все зарегистрированные пользователи хранятся в БД. 
Все пароли пользователей хранятся в БД в закодированном виде. Форма авторизации:<br><br>
![Авторизация пользователя 1](img/about/auth1.PNG)<br><br>
![Авторизация пользователя 2](img/about/auth2.PNG)<br><br>
![Авторизация пользователя 3](img/about/auth3.PNG)<br><br>
* По умолчанию в БД хранится пользователь с ролью администратора. Его логин - root, пароль - secret<br><br>
* Все формы приложения провалидированы с помощью JS и JQuery:<br><br>
![Валидация 1](img/about/valid1.PNG)<br><br>
![Валидация 2](img/about/valid2.PNG)<br><br>
![Валидация 3](img/about/valid3.PNG)<br><br>
* Конфигурация всех технологий проекта произведена с помощью Java-классов вместо xml-конфигурации<br><br>
* Проект построен на трёх слоях: слой по работе с БД, слой контроллеров и слой сервисов<br><br>
* Для работы с БД по умолчанию используется Spring Data JPA. Есть также возможность заменить данную реализацию 
на Spring JDBC, Spring HibernateTemplate или же хранить все данные в памяти<br><br>
* Слой контроллеров использует Spring MVC<br><br>
* Слой сервисов содержит логику приложения<br><br>
* В качестве БД используется PostgreSQL<br><br>
* Пул соединений к БД основан на Apache Commons DBCP<br><br>
* Проект построен по шаблону MVC. Все виды открываются через GET-методы контроллеров, 
что позволяет передавать на виды необходимые данные<br><br>
* Для логирования используется связка slf4j и log4j<br><br>
* В качестве видов используются JSP-страницы, реализованные с помощью HTML и Bootstrap<br><br>
* Для реализации логики отображения на видах используется JSTL.
## Сборка
1. Установить JDK 14.
2. Скачать Maven.
3. Создать переменные окружения JAVA_HOME и M2_HOME и прописать в переменную окружения Path 
пути до бинарных файлов для JDK и для Maven:<br><br>
![Java Maven installing](img/build/java_maven.PNG)<br><br>
4. Установить сервер БД PostgreSQL. При установке задать:<br>
    * имя пользователя - postgres 
    * пароль - root
    * порт - 5432<br>
Также при установке сервера БД PostgreSQL нужно установить программу pg_Admin.

5. Скачать и установить Tomcat.
6. Скачать исходный код проекта с GitHub.
7. Перейти в корень проекта, где лежит файл pom.xml:<br><br>
![Переход в корень проекта 1](img/build/cd.PNG)<br><br>
![Переход в корень проекта 2](img/build/cd1.PNG)<br><br>
8. С помощью Maven осуществить сборку проекта:<br><br>
![Сборка проекта](img/build/package.PNG)<br><br>
При успешной сборке должна появиться папка target, в которой располагается war-архив:<br><br>
![Сборка прошла успешно](img/build/package1.PNG)<br><br>
![Папка target](img/build/target.PNG)<br><br>
![war-архив](img/build/target1.PNG)<br><br>
9. Переименовать war-архив:<br><br>
![Переименовать war-архив](img/build/target3.PNG)<br><br>
10. Запустить сервер БД, указав путь до папки data:<br><br>
![Запуск сервера БД](img/build/server_start.PNG)<br><br>
11. Запустить программу pg_Admin, установленную вместе с сервером БД PostgreSQL:<br><br>
![Запуск pg_Admin](img/build/pg_admin.PNG)<br><br>
12. Создать БД с названием auto_crash:<br><br>
![БД dreamjob](img/build/auto_crash_db.PNG)<br><br>
13. Открыть Query Tool для созданной БД и запустить SQL-скрипты schema.sql и security.schema.reg.sql,
находящиеся в папке db (данная папка находится в корне скачанного проекта):<br><br>
![Скрипт schema.sql](img/build/script.PNG)<br><br>
![Запуск скрипта schema.sql](img/build/pg_admin_script1.PNG)<br><br>
![Запуск скрипта security.schema.reg.sql](img/build/pg_admin_script2.PNG)<br><br>
Если нужно задать другие списки типов и статей для инцидентов, то нужно сделать это до запуска SQL-скрипта schema.sql 
в следующих строчках скрипта:<br><br>
![Изменение скрипта schema.sql](img/build/change_script.PNG)<br><br>
14. Задеплоить собранный war-архив в папку webapps, находящуюся в корневой папке скачанного Tomcat:<br><br>
![Деплой war-архива](img/build/deploy.PNG)<br><br>
Сборка завершена. Теперь можно проверить работу приложения.
## Использование
Запускаем Tomcat:<br><br>
![Запуск Tomcat 1](img/usage/tomcat_start.PNG)<br><br>
![Запуск Tomcat 2](img/usage/tomcat_start1.PNG)<br><br>
Переходим на главную страницу приложения 
[http://localhost:8080/accident/](http://localhost:8080/accident/): <br><br>
![Вход под админом 1](img/usage/admin1.PNG)<br><br>
Как видно, мы были переведены на форму авторизации, что означает, что с приложением могут работать только авторизованные 
пользователи. По умолчанию в БД уже хранится один пользователь с ролью администратора. Поэтому мы можем войти через 
администратора (логин - root, пароль - secret):<br><br>
![Вход под админом 2](img/usage/admin2.PNG)<br><br>
![Главная страница](img/usage/index.PNG)<br><br>
Теперь осуществим выход и зарегистрируем нового пользователя:<br><br>
![Выход](img/usage/reg1.PNG)<br><br>
![Регистрация](img/usage/reg2.PNG)<br><br>
Авторизуемся под только что созданным пользователем при этом введём некорректный пароль:<br><br>
![Авторизация 0](img/usage/auth0.PNG)<br><br>
![Авторизация 1](img/usage/auth1.PNG)<br><br>
Как видно, мы получили предупреждение.
Теперь введём корректные данные:<br><br>
![Авторизация 2](img/usage/auth2.PNG)<br><br>
![Авторизация 3](img/usage/auth3.PNG)<br><br>
Добавим новый инцидент:<br><br>
![Добавление инцидента 1](img/usage/add1.PNG)<br><br>
![Добавление инцидента 2](img/usage/add2.PNG)<br><br>
Отредактируем добавленный инцидент:<br><br>
![Редактирование инцидента 1](img/usage/edit1.PNG)<br><br>
![Редактирование инцидента 2](img/usage/edit2.PNG)<br><br>
![Редактирование инцидента 3](img/usage/edit3.PNG)<br><br>
Проверим валидацию. Для этого нажмём на кнопки отправки форм, при этом не заполнив все поля форм:<br><br>
![Проверка валидации 1](img/usage/valid1.PNG)<br><br>
![Проверка валидации 2](img/usage/valid2.PNG)<br><br>
![Проверка валидации 3](img/usage/valid3.PNG)<br><br>
## Контакты
Почта: studentnstu97@mail.ru<br>
Skype: live:.cid.9cdc925fb48220b4